import Checkbox from"../vendors/rui/rui-checkbox.min.js";import Switch from"../vendors/rui/rui-switch.min.js";import Input from"../vendors/rui/rui-input.min.js";import Select from"../vendors/rui/rui-select.min.js";import Textarea from"../vendors/rui/rui-textarea.min.js";export default class{constructor(e){this.DataGridContainer=document.querySelector('[data-grid="orders"]'),this.Rows=e.rows,this.RowIDs=e.rowIds,this.NumRows=e.numRows,this.CrudUrl=e.crudUrl,this.init()}init(){this.Columns=["Customer ID","Customer First Name","Customer Last Name","General Status","Delivery Status","Payment Status","Comments","Order Date"],this.dbColumns=["orders.cId","fname","lname","genStatus","delStatus","pmtStatus","comments","orders.createdAt"],this.Currency=new Intl.NumberFormat("en-US",{style:"currency",currency:"USD"}),this.Date_=new Intl.DateTimeFormat("en-US",{dateStyle:"full"}),this.RPPVs=[5,10,25,50,100],this.RPPDV=25,this.ScrollbarWidth=15,this.Operations=[{value:"=",textContent:"equal"},{value:"!=",textContent:"not equal"},{value:">",textContent:"greater than"},{value:">=",textContent:"greater than or equal"},{value:"<",textContent:"less than"},{value:"<=",textContent:"less than or equal"},{value:"contain",textContent:"contain"},{value:"startWith",textContent:"start with"},{value:"endWith",textContent:"end with"},{value:"isEmpty",textContent:"is empty"},{value:"isNotEmpty",textContent:"is not empty"}],this.FilterTimer=null,this.DataGrid=document.createElement("datagrid-rui"),this.CreateAlert(),this.CreateToolbar(),this.CreateMain(),this.CreateFooter(),this.DataGridContainer.appendChild(this.DataGrid),this.SizeColumns(),this.SetupAllCheckbox(),this.SetupCheckboxes(),this.SetupResizingColumns(),this.SetupNextPrevBtns()}CreateAlert(){this.Alert=document.createElement("rwc-alert"),document.body.appendChild(this.Alert)}CreateToolbar(){this.Toolbar=document.createElement("toolbar-rui"),this.CreateColumnsPanelContainer(),this.CreateFiltersPanelContainer(),this.CreateSortsPanelContainer(),this.CreateNewModal().then((()=>this.CreateDeleteModal())),this.CreateUpdateModal(),this.DataGrid.appendChild(this.Toolbar)}CreateColumnsPanelContainer(){const e=document.createElement("toolbar-panel-container-rui"),t=document.createElement("button");t.type="button",t.value=0,t.className="toolbar-btn",t.innerHTML='<i class="fas fa-columns"></i> Columns';const n=document.createElement("indicator-rui");n.className="hide",t.appendChild(n);const a=document.createElement("toolbar-panel-rui");a.className="columns hide";const s=document.createElement("panel-header-rui");s.appendChild(Input({attrs:{type:"text",placeholder:"Find Column"},evts:{input:function(){const e=a.querySelectorAll("label[data-switch-container]"),t=this.value.trim().toLowerCase();for(const n of e){n.children[1].textContent.trim().toLowerCase().indexOf(t)>-1?n.classList.remove("hide"):n.classList.add("hide")}}}}));const i=document.createElement("panel-content-rui"),o=this;for(let e=0;e<this.Columns.length;e++)i.appendChild(Switch({labelText:this.Columns[e],attrs:{checked:""},evts:{change:function(){const a=o.HeadingsContainer.querySelectorAll("hcol-rui")[e+1],s=o.RowsContainer.querySelectorAll(`[data-colindex="${e}"]`);if(this.checked){a.classList.remove("hide");for(const e of s)e.classList.remove("hide");t.value=+t.value-1}else{a.classList.add("hide");for(const e of s)e.classList.add("hide");t.value=+t.value+1}+t.value>0?n.classList.remove("hide"):n.classList.add("hide")}}}));const l=document.createElement("panel-footer-rui"),r=i.querySelectorAll("input"),d=document.createElement("button");d.type="button",d.className="panel-btn",d.textContent="HIDE ALL",d.addEventListener("click",(()=>{for(const e of r)e.checked&&e.click()}));const c=document.createElement("button");c.type="button",c.className="panel-btn",c.textContent="SHOW ALL",c.addEventListener("click",(()=>{for(const e of r)e.checked||e.click()})),l.appendChild(d),l.appendChild(c),a.appendChild(s),a.appendChild(i),a.appendChild(l),t.addEventListener("click",(e=>{if(this.Toolbar.querySelector("toolbar-panel-rui.filters").classList.contains("hide")||this.Toolbar.querySelectorAll(".toolbar-btn")[1].click(),this.Toolbar.querySelector("toolbar-panel-rui.sorts").classList.contains("hide")||this.Toolbar.querySelectorAll(".toolbar-btn")[2].click(),!a.classList.contains("hide"))return;e.stopPropagation(),a.classList.toggle("hide"),s.querySelector("input").focus();const t=e=>{-1===this.ElemIsDescendantOf(e.target,a)&&(a.classList.add("hide"),window.removeEventListener("click",t))};window.addEventListener("click",t)})),e.appendChild(t),e.appendChild(a),this.Toolbar.appendChild(e)}SetOperatorVisibility(e){const t=e.querySelectorAll("[data-operators]");if(1!==t.length)for(let e=0;e<t.length;e++)0===e?t[e].className="mr-_5 invisible":1===e?(t[e].className="mr-_5",t[e].children[0].removeAttribute("disabled")):(t[e].className="mr-_5",t[e].children[0].setAttribute("disabled",""));else t[0].className="mr-_5 hidden"}CreateFilterRow(e,t,n){const a=this,s=document.createElement("row-rui"),i=document.createElement("div");i.setAttribute("delete-row","");const o=document.createElement("button");o.type="button",o.innerHTML="&times;",o.addEventListener("click",(function(s){const i=+e.getAttribute("data-rows");if(i>1){s.stopPropagation();const o=this.parentElement.parentElement;o.hasAttribute("data-has-filter")&&(t.value=+t.value-1,+t.value>0?n.classList.remove("hide"):n.classList.add("hide")),o.remove(),a.SetOperatorVisibility(e),e.setAttribute("data-rows",i-1),a.FilterReadData()}else{const e=this.parentElement.parentElement;if(!e.hasAttribute("data-has-filter"))return;e.removeAttribute("data-has-filter");const s=e.children[2].children[0],i=e.children[3].children[0],o=e.children[4].children[0];s.value=a.Columns[Object.keys(a.Columns)[0]].dbName,i.value=a.Operations[0].value,i.setAttribute("data-value",a.Operations[0].value),o.value=null,o.parentElement.classList.remove("invisible"),t.value=+t.value-1,+t.value>0?n.classList.remove("hide"):n.classList.add("hide"),a.FilterReadData()}})),i.appendChild(o);const l=Select({labelText:"Operators",attrs:{class:"w8"},evts:{change:function(){const t=e.querySelectorAll("[data-operators]");for(const e of t)e.children[0].value=this.value;this.parentElement.parentElement.hasAttribute("data-has-filter")&&a.FilterReadData()}},options:[{value:"AND",textContent:"And"},{value:"OR",textContent:"Or"}]});if(l.setAttribute("data-operators",""),l.className="mr-_5 hidden",e.children.length>0){"AND"===e.lastElementChild.children[1].children[0].value?l.children[0].value="AND":l.children[0].value="OR"}const r=[];for(let e=0;e<this.Columns.length;e++)r.push({value:this.dbColumns[e],textContent:this.Columns[e]});const d=Select({labelText:"Columns",attrs:{class:"w14"},evts:{change:function(){this.parentElement.parentElement.hasAttribute("data-has-filter")&&a.FilterReadData()}},options:r});d.classList.add("mr-_5");const c=Select({labelText:"Operations",attrs:{class:"w17","data-value":this.Operations[0].value},evts:{change:function(){const e=this.parentElement.nextElementSibling.children[0],s=this.parentElement.parentElement;"isEmpty"===this.value||"isNotEmpty"===this.value?(e.parentElement.classList.add("invisible"),e.value=null,s.hasAttribute("data-has-filter")||(s.setAttribute("data-has-filter",""),t.value=+t.value+1),a.FilterReadData()):"isEmpty"===this.getAttribute("data-value")||"isNotEmpty"===this.getAttribute("data-value")?(e.parentElement.classList.remove("invisible"),s.removeAttribute("data-has-filter"),t.value=+t.value-1,a.FilterReadData()):e.value&&a.FilterReadData(),this.setAttribute("data-value",this.value),+t.value>0?n.classList.remove("hide"):n.classList.add("hide")}},options:this.Operations});c.classList.add("mr-_5"),s.appendChild(i),s.appendChild(l),s.appendChild(d),s.appendChild(c),s.appendChild(Input({attrs:{class:"w18",placeholder:"Filter Value"},evts:{input:function(){clearTimeout(a.FilterTimer),a.FilterTimer=setTimeout((()=>{this.value?this.parentElement.parentElement.hasAttribute("data-has-filter")||(this.parentElement.parentElement.setAttribute("data-has-filter",""),t.value=+t.value+1):(this.parentElement.parentElement.removeAttribute("data-has-filter"),t.value=+t.value-1),+t.value>0?n.classList.remove("hide"):n.classList.add("hide"),a.FilterReadData()}),1e3)}}})),e.appendChild(s);const u=+e.getAttribute("data-rows");e.setAttribute("data-rows",u+1)}CreateFiltersPanelContainer(){const e=document.createElement("toolbar-panel-container-rui"),t=document.createElement("button");t.type="button",t.value=0,t.className="toolbar-btn",t.innerHTML='<i class="fas fa-filter"></i> Filters';const n=document.createElement("indicator-rui");n.className="hide",t.appendChild(n);const a=document.createElement("toolbar-panel-rui");a.className="filters hide";const s=document.createElement("panel-content-rui");s.setAttribute("data-rows",0),this.CreateFilterRow(s,t,n);const i=document.createElement("panel-footer-rui"),o=document.createElement("button");o.type="button",o.className="panel-btn",o.innerHTML='<i class="fas fa-plus"></i> ADD FILTER',o.addEventListener("click",(()=>{this.CreateFilterRow(s,t,n),this.SetOperatorVisibility(s)})),i.appendChild(o),a.appendChild(s),a.appendChild(i),t.addEventListener("click",(e=>{if(this.Toolbar.querySelector("toolbar-panel-rui.columns").classList.contains("hide")||this.Toolbar.querySelectorAll(".toolbar-btn")[0].click(),this.Toolbar.querySelector("toolbar-panel-rui.sorts").classList.contains("hide")||this.Toolbar.querySelectorAll(".toolbar-btn")[2].click(),!a.classList.contains("hide"))return;e.stopPropagation(),a.classList.remove("hide"),s.querySelector("input").focus();const t=e=>{-1===this.ElemIsDescendantOf(e.target,a)&&(a.classList.add("hide"),window.removeEventListener("click",t))};window.addEventListener("click",t)})),e.appendChild(t),e.appendChild(a),this.Toolbar.appendChild(e)}CreateSortsPanelContainer(){const e=document.createElement("toolbar-panel-container-rui"),t=document.createElement("button");t.type="button",t.value=0,t.className="toolbar-btn",t.innerHTML='<i class="fas fa-sort"></i> Sorts';const n=document.createElement("indicator-rui");n.className="hide",t.appendChild(n);const a=document.createElement("toolbar-panel-rui");a.className="sorts hide";const s=document.createElement("panel-header-rui");s.appendChild(Input({attrs:{type:"text",placeholder:"Find Column"},evts:{input:function(){const e=a.querySelectorAll("row-rui"),t=this.value.trim().toLowerCase();for(const n of e){n.children[1].textContent.trim().toLowerCase().indexOf(t)>-1?n.classList.remove("hide"):n.classList.add("hide")}}}}));const i=document.createElement("panel-content-rui"),o=(e,n)=>{e.removeAttribute("data-has-sort"),n.disabled=!0,n.value=null,n.removeAttribute("data-value");for(let e=0;e<+t.value;e++)n.children[e].disabled=!0},l=[];for(let e=0;e<this.Columns.length;e++)l.push({value:e+1,textContent:e+1,disabled:""});const r=this;for(let e=0;e<this.Columns.length;e++){const s=document.createElement("row-rui"),d=Select({labelText:"Order",attrs:{"data-order":"",disabled:""},evts:{change:function(){const e=a.querySelector(`[data-value="${this.value}"]`);e.value=this.getAttribute("data-value"),e.setAttribute("data-value",this.getAttribute("data-value")),this.setAttribute("data-value",this.value),r.ReadData()}},options:l});d.classList.add("mr-_5");const c=document.createElement("span");c.textContent=this.Columns[e],c.title=this.Columns[e],c.setAttribute("data-column",this.dbColumns[e]),c.className="mr-_5";const u=Select({labelText:"Direction",attrs:{"data-direction":"",class:"w12"},evts:{change:function(){const e=this.parentElement.parentElement,s=e.children[0].children[0];if("ASC"===this.value||"DESC"===this.value){e.hasAttribute("data-has-sort")||(t.value=+t.value+1,+t.value>0?n.classList.remove("hide"):n.classList.add("hide")),e.setAttribute("data-has-sort",""),s.disabled=!1;const i=a.querySelectorAll("[data-has-sort] [data-order]");for(const e of i)for(let n=0;n<+t.value;n++)e.children[n].disabled=!1;s.value=t.value,s.setAttribute("data-value",t.value)}else{const i=+s.value;o(e,s),t.value=+t.value-1,+t.value>0?n.classList.remove("hide"):n.classList.add("hide");const l=a.querySelectorAll("[data-has-sort] [data-order]");for(const e of l)+e.value>i&&(e.value=+e.value-1,e.setAttribute("data-value",e.value)),e.children[+t.value].disabled=!0}r.ReadData()}},options:[{value:"unsorted",textContent:"Unsorted"},{value:"ASC",textContent:"Ascending"},{value:"DESC",textContent:"Descending"}]});u.classList.add("mr-_5"),s.appendChild(d),s.appendChild(c),s.appendChild(u),i.appendChild(s)}const d=document.createElement("panel-footer-rui"),c=document.createElement("button");c.type="button",c.className="panel-btn",c.textContent="RESET ALL",c.addEventListener("click",(function(){const e=a.querySelectorAll("[data-has-sort]");if(0!==e.length){for(const t of e){const e=t.children[0].children[0];t.children[2].children[0].value="unsorted",o(t,e)}t.value=0,n.classList.add("hide"),r.ReadData()}})),d.appendChild(c),a.appendChild(s),a.appendChild(i),a.appendChild(d),t.addEventListener("click",(e=>{if(this.Toolbar.querySelector("toolbar-panel-rui.columns").classList.contains("hide")||this.Toolbar.querySelectorAll(".toolbar-btn")[0].click(),this.Toolbar.querySelector("toolbar-panel-rui.filters").classList.contains("hide")||this.Toolbar.querySelectorAll(".toolbar-btn")[1].click(),!a.classList.contains("hide"))return;e.stopPropagation(),a.classList.remove("hide");const t=e=>{-1===this.ElemIsDescendantOf(e.target,a)&&(a.classList.add("hide"),window.removeEventListener("click",t))};window.addEventListener("click",t)})),e.appendChild(t),e.appendChild(a),this.Toolbar.appendChild(e)}HTMLStringToNode(e){const t=document.createElement("div");return t.innerHTML=e,t.children}SelectCustomer(){const e=new FormData;return e.append("REQUEST_ACTION","READ_ALL_CUSTOMER"),fetch(this.CrudUrl,{method:"POST",body:e}).then((e=>e.json())).then((e=>{const t=[];t.push({value:"",textContent:"Select a customer..."});for(const n of e)t.push({value:n.cId,textContent:`${n.title} ${n.fname} ${n.lname}`.trim()});return Select({labelText:"Customer",attrs:{name:"cId",required:""},options:t})})).catch((e=>{}))}SelectProduct(){const e=[];e.push({value:"",textContent:"Select a product..."});for(const t of this.ProductRows)e.push({value:t.pId,textContent:t.name});const t=this;return Select({labelText:"Product",attrs:{required:"",name:"pId[]"},evts:{change:function(){const e=this.parentElement.nextElementSibling.children[0],n=this.parentElement.parentElement.children[3].children[0],a=this.parentElement.parentElement.children[4].children[0],s=this.parentElement.parentElement.children[5].children[0],i=this.parentElement.parentElement.parentElement.querySelectorAll("[data-value]"),o=this.parentElement.parentElement.parentElement.parentElement.querySelector('[data-id="total"]');let l=0;const r=t.ProductRows.find((e=>e.pId===this.value));if(n.value=r?r.unit:"",a.value=r?r.unitPrice:"",e.value&&r){const n=+e.value*+a.value;s.setAttribute("data-value",n),s.value=t.Currency.format(n)}else s.setAttribute("data-value",0),s.value="$0.00";for(const e of i)l+=+e.getAttribute("data-value");o.value=t.Currency.format(l)}},options:e})}CreateProductRow(){const e=this,t=document.createElement("row-rui"),n=document.createElement("div");n.className="delete-row hidden";const a=document.createElement("button");a.type="button",a.innerHTML="&times;",a.addEventListener("click",(function(){const t=this.parentElement.parentElement.parentElement.children,n=this.parentElement.parentElement.parentElement,a=this.parentElement.parentElement.parentElement.parentElement.querySelector('[data-id="total"]');let s=0;this.parentElement.parentElement.remove(),1===t.length&&t[0].children[0].classList.add("hidden");for(const e of n.querySelectorAll("[data-value]"))s+=+e.getAttribute("data-value");a.value=e.Currency.format(s)})),n.appendChild(a),t.appendChild(n),t.appendChild(this.SelectProduct()),t.appendChild(Input({attrs:{type:"number",required:"",name:"quantity[]",placeholder:"Quantity",min:.25,step:.25},evts:{input:function(){const t=this.parentElement.previousElementSibling.children[0],n=this.parentElement.parentElement.children[4].children[0],a=this.parentElement.parentElement.children[5].children[0],s=this.parentElement.parentElement.parentElement.querySelectorAll("[data-value]"),i=this.parentElement.parentElement.parentElement.parentElement.querySelector('[data-id="total"]');let o=0;if(t.value&&this.value){const t=+this.value*+n.value;a.setAttribute("data-value",t),a.value=e.Currency.format(t)}else a.setAttribute("data-value",0),a.value="$0.00";for(const e of s)o+=+e.getAttribute("data-value");i.value=e.Currency.format(o)}}})),t.appendChild(Input({attrs:{type:"text",placeholder:"Units",readonly:""}}));const s=Input({attrs:{type:"number",placeholder:"Price ($)",readonly:""}});return s.className="mx-width",t.appendChild(s),t.appendChild(Input({attrs:{type:"text",placeholder:"Sub Total",readonly:"","data-value":0,value:"$0.00"}})),t}FetchProductRows(){const e=new FormData;return e.append("REQUEST_ACTION","READ_ALL_PRODUCT"),fetch(this.CrudUrl,{method:"POST",body:e}).then((e=>e.json())).then((e=>(this.ProductRows=e,this.CreateProductRow()))).catch((e=>{}))}async CreateNewModal(){const e=this;this.NewModal=document.createElement("rwc-modal"),this.NewModal.modalOutlineColor="hsl(93, 98%, 30%)",this.NewModal.innerHTML='\n            <span slot="heading">Add New Order</span>\n            <div slot="body-content"><form></form></div>\n        ';const t=this.NewModal.querySelector("form");t.appendChild(await this.SelectCustomer());const n=document.createElement("container-rui"),a=document.createElement("content-rui");a.appendChild(await this.FetchProductRows());const s=document.createElement("footer-rui"),i=document.createElement("button");i.type="button",i.className="add-btn",i.innerHTML='<i class="fas fa-plus"></i> ADD PRODUCT',i.addEventListener("click",(function(){a.appendChild(e.CreateProductRow());for(let e=0;e<a.children.length;e++)a.children[e].children[0].classList.remove("hidden")})),s.appendChild(i),s.appendChild(Input({attrs:{type:"text",placeholder:"Total",readonly:"","data-id":"total","data-value":0,value:"$0.00"}})),n.appendChild(a),n.appendChild(s),t.appendChild(n),t.append(...this.HTMLStringToNode('\n            <div class="reset-submit">\n                <button type="reset" class="red">RESET</button>\n                <button type="submit" class="green">SUBMIT</button>\n            </div>\n        ')),t.addEventListener("submit",(function(t){t.preventDefault(),e.Alert.closeAlert();const n={cId:+this.cId.value,pIds:[],quantities:[]};if("[object RadioNodeList]"===this["pId[]"].toString())for(let e=0;e<this["pId[]"].length;e++)n.pIds.push(+this["pId[]"][e].value),n.quantities.push(+this["quantity[]"][e].value);else n.pIds.push(+this["pId[]"].value),n.quantities.push(+this["quantity[]"].value);const a=new FormData;a.append("order",JSON.stringify(n)),a.append("REQUEST_ACTION","CREATE"),fetch(e.CrudUrl,{method:"POST",body:a}).then((e=>e.json())).then((t=>{if(t.success)e.NewModal.querySelector("form").reset(),e.ReadData(),e.Alert.innerHTML=`\n                            <span slot="status">Success!</span>\n                            <span slot="message">${t.message}</span>\n                        `,e.Alert.alertColor="#bdd9a6",e.Alert.openAlert();else{const n="object"==typeof t.message?"Invalid data detected! Please remove invalid data and submit again.":"Something went wrong. Please try again later.";e.Alert.innerHTML=`\n                            <span slot="status">Failure!</span>\n                            <span slot="message">${n}</span>\n                        `,e.Alert.alertColor="#d9a6af",e.Alert.openAlert()}})).catch((e=>{}))})),document.body.appendChild(this.NewModal);const o=this.HTMLStringToNode('\n            <button type="button" class="toolbar-btn new">\n                <i class="fas fa-plus"></i> New\n            </button>\n        ')[0];o.addEventListener("click",(()=>this.NewModal.openModal())),this.Toolbar.appendChild(o)}CreateDeleteModal(){this.DeleteModal=document.createElement("rwc-modal"),this.DeleteModal.modalOutlineColor="hsl(349, 84%, 65%)",this.DeleteModal.innerHTML='\n            <span slot="heading"></span>\n            <div slot="body-content">\n                <div class="body-text"></div>\n                <form>\n                    <div class="reset-submit">\n                        <button type="reset" class="green">CANCEL</button>\n                        <button type="submit" class="red">DELETE</button>\n                    </div>\n                </form>\n            </div>\n        ',document.body.appendChild(this.DeleteModal),this.DeleteModal.querySelector('button[type="reset"]').addEventListener("click",(()=>this.DeleteModal.closeModal()));const e=this;this.DeleteModal.querySelector("form").addEventListener("submit",(function(t){t.preventDefault(),e.Alert.closeAlert();const n=[],a=e.RowsContainer.querySelectorAll("row-rui.selected");for(const e of a)n.push(+e.getAttribute("data-entity-id"));const s=new FormData;s.append("REQUEST_ACTION","DELETE"),s.append("ids",JSON.stringify(n)),fetch(e.CrudUrl,{method:"POST",body:s}).then((e=>e.json())).then((t=>{if(t.success)e.DeleteModal.closeModal(),e.ReadData(),e.Alert.innerHTML=`\n                            <span slot="status">Success!</span>\n                            <span slot="message">${t.message}</span>\n                        `,e.Alert.alertColor="#bdd9a6",e.Alert.openAlert();else{const n="Invalid ID(s)!"===t.message?"Invalid ID(s) detected! Please remove invalid ID(s) and try again.":"Something went wrong. Please try again later.";e.Alert.innerHTML=`\n                            <span slot="status">Failure!</span>\n                            <span slot="message">${n}</span>\n                        `,e.Alert.alertColor="#d9a6af",e.Alert.openAlert()}})).catch((e=>{}))}));const t=this.HTMLStringToNode('\n            <button type="button" class="toolbar-btn del">\n                <i class="far fa-trash-alt"></i> Delete\n            </button>\n        ')[0];t.addEventListener("click",(()=>{const e=+this.Footer.querySelector("num-selected-rows-rui").textContent.split(" row")[0],t=this.DeleteModal.querySelector('[slot="heading"]'),n=this.DeleteModal.querySelector(".body-text"),a=this.DeleteModal.querySelector('button[type="submit"]');0===e?(t.textContent="No Rows Selected!",n.textContent="Please select some row(s) first then click delete.",a.disabled=!0):(t.textContent="Are You Sure?",n.textContent=`Are you sure you want to permanently delete ${1===e?"1 row":e+" rows"}? This action cannot be undone!`,a.disabled=!1),this.DeleteModal.openModal()})),this.Toolbar.appendChild(t)}CreateUpdateModal(){this.UpdateModal=document.createElement("rwc-modal"),this.UpdateModal.modalOutlineColor="hsl(93, 98%, 30%)",this.UpdateModal.innerHTML='\n            <span slot="heading">View & Update Order</span>\n            <div slot="body-content"><form></form></div>\n        ';const e=this.UpdateModal.querySelector("form"),t=document.createElement("div");t.className="row",t.appendChild(Input({attrs:{type:"text",placeholder:"Customer ID",readonly:""}})),t.appendChild(Input({attrs:{type:"text",placeholder:"Customer First Name",readonly:""}})),t.appendChild(Input({attrs:{type:"text",placeholder:"Customer Last Name",readonly:""}}));const n=document.createElement("div");n.className="row",n.appendChild(Select({labelText:"General Status",attrs:{name:"genStatus"},options:[{textContent:"Not Completed"},{textContent:"Partially Completed"},{textContent:"Completed"}]})),n.appendChild(Select({labelText:"Delivery Status",attrs:{name:"delStatus"},options:[{textContent:"Not Delivered"},{textContent:"Partially Delivered"},{textContent:"Delivered"}]})),n.appendChild(Select({labelText:"Payment Status",attrs:{name:"pmtStatus"},options:[{textContent:"Not Paid"},{textContent:"Partially Paid"},{textContent:"Paid"}]}));const a=document.createElement("container-rui"),s=document.createElement("content-rui"),i=document.createElement("footer-rui"),o=document.createElement("button");o.type="button",o.className="add-btn",o.innerHTML='<i class="fas fa-plus"></i> ADD PRODUCT',o.addEventListener("click",(()=>{s.appendChild(this.CreateProductRow());for(let e=0;e<s.children.length;e++)s.children[e].children[0].classList.remove("hidden")})),i.appendChild(o),i.appendChild(Input({attrs:{type:"text",placeholder:"Total",readonly:"","data-id":"total","data-value":0,value:"$0.00"}})),a.appendChild(s),a.appendChild(i),e.appendChild(t),e.appendChild(n),e.appendChild(Textarea({attrs:{name:"comments",rows:4,placeholder:"Comments"}})),e.appendChild(a),e.append(...this.HTMLStringToNode('\n            <div class="reset-submit">\n                <button type="reset" class="red">CANCEL</button>\n                <button type="submit" class="green">UPDATE</button>\n            </div>\n        ')),this.UpdateModal.querySelector('button[type="reset"]').addEventListener("click",(()=>this.UpdateModal.closeModal()));const l=this;e.addEventListener("submit",(function(e){e.preventDefault(),l.Alert.closeAlert();const t={oId:this.oId,genStatus:this.genStatus.value,delStatus:this.delStatus.value,pmtStatus:this.pmtStatus.value,comments:this.comments.value,pIds:[],quantities:[]};if("[object RadioNodeList]"===this["pId[]"].toString())for(let e=0;e<this["pId[]"].length;e++)t.pIds.push(+this["pId[]"][e].value),t.quantities.push(+this["quantity[]"][e].value);else t.pIds.push(+this["pId[]"].value),t.quantities.push(+this["quantity[]"].value);const n=new FormData;n.append("order",JSON.stringify(t)),n.append("REQUEST_ACTION","UPDATE"),fetch(l.CrudUrl,{method:"POST",body:n}).then((e=>e.json())).then((e=>{if(e.success)l.UpdateModal.closeModal(),l.ReadData(),l.Alert.innerHTML=`\n                            <span slot="status">Success!</span>\n                            <span slot="message">${e.message}</span>\n                        `,l.Alert.alertColor="#bdd9a6",l.Alert.openAlert();else{const t="object"==typeof e.message?"Invalid data detected! Please remove invalid data and submit again.":"Something went wrong. Please try again later.";l.Alert.innerHTML=`\n                            <span slot="status">Failure!</span>\n                            <span slot="message">${t}</span>\n                        `,l.Alert.alertColor="#d9a6af",l.Alert.openAlert()}})).catch((e=>{}))})),document.body.appendChild(this.UpdateModal)}CreateMain(){this.Main=document.createElement("main-rui"),this.CreateHeadingsContainer(),this.CreateRowsContainer(),this.DataGrid.appendChild(this.Main)}PxToRem(e){return window.innerWidth>=2700?+e/15:window.innerWidth>=1800?+e/12.5:window.innerWidth>=900?+e/10:+e/7.5}CreateHeadingsContainer(){this.HeadingsContainer=document.createElement("headings-container-rui");const e=document.createElement("headings-rui"),t=document.createElement("hcol-rui");t.className="select-column",t.appendChild(Checkbox({attrs:{"data-checkbox-group-all":"","data-checkbox-selected-count":0}})),e.appendChild(t);for(let t=0;t<this.Columns.length;t++){const n=document.createElement("hcol-rui");n.setAttribute("data-column",this.dbColumns[t]);const a=document.createElement("div");a.textContent=this.Columns[t],a.style.display="inline-block",a.style.opacity=0,document.body.appendChild(a);const s=this.PxToRem(a.scrollWidth+24);document.body.removeChild(a),n.style.minWidth=s>=5?`${s}rem`:"5rem",n.style.maxWidth=s>=5?`${s}rem`:"5rem";const i=document.createElement("heading-title-rui");i.textContent=this.Columns[t];const o=document.createElement("resizable-rui");o.setAttribute("data-colindex",t);const l=document.createElement("resizable-icon-rui");o.appendChild(l),n.appendChild(i),n.appendChild(o),e.appendChild(n)}this.HeadingsContainer.appendChild(e),this.Main.appendChild(this.HeadingsContainer)}CreateRowsContainer(){this.RowsContainer=document.createElement("rows-container-rui"),this.BoundColumnNavigate=this.ColumnNavigate.bind(this),this.CreateRows(),this.Main.appendChild(this.RowsContainer),this.RowsContainer.addEventListener("scroll",(()=>{this.HeadingsContainer.children[0].style.transform=`translateX(-${this.RowsContainer.scrollLeft}px)`}))}ColumnNavigate(e){switch(e.preventDefault(),e.key){case"ArrowUp":this.FocusedRow.previousElementSibling?.focus();break;case"ArrowDown":this.FocusedRow.nextElementSibling?.focus();break;case"PageUp":this.RowsContainer.querySelector('[data-rowindex="0"]').focus();break;case"PageDown":this.RowsContainer.querySelector(`[data-rowindex="${+this.Pagination.querySelector("offset-max-rui").textContent-1}"]`).focus();break;case"Enter":this.FocusedRow.dispatchEvent(new MouseEvent("dblclick"));break;default:}}CreateRows(){const e=this;this.RowsContainer.innerHTML=null;for(let t=0;t<this.Rows.length;t++){const n=document.createElement("row-rui");n.tabIndex=0,n.setAttribute("data-rowindex",t),n.setAttribute("data-entity-id",this.RowIDs[t][Object.keys(this.RowIDs[t])[0]]);const a=document.createElement("col-rui");a.className="select-column",a.appendChild(Checkbox({attrs:{"data-checkbox-group-single":""}})),n.appendChild(a);let s=0;for(let e in this.Rows[t]){const a=document.createElement("col-rui");a.setAttribute("data-colindex",s),a.textContent="createdAt"===e?this.Date_.format(new Date(this.Rows[t][e])):this.Rows[t][e]?this.Rows[t][e]:"",n.appendChild(a),s++}n.addEventListener("focus",(function(){e.FocusedRow=this})),n.addEventListener("keydown",this.BoundColumnNavigate),n.addEventListener("dblclick",(function(){e.UpdateModal.querySelector("form").oId=+this.getAttribute("data-entity-id"),e.UpdateModal.querySelector('input[placeholder="Customer ID"]').value=this.children[1].textContent,e.UpdateModal.querySelector('input[placeholder="Customer First Name"]').value=this.children[2].textContent,e.UpdateModal.querySelector('input[placeholder="Customer Last Name"]').value=this.children[3].textContent;for(const t of e.UpdateModal.querySelector('select[name="genStatus"]').options)if(t.textContent===this.children[4].textContent){t.selected=!0;break}for(const t of e.UpdateModal.querySelector('select[name="delStatus"]').options)if(t.textContent===this.children[5].textContent){t.selected=!0;break}for(const t of e.UpdateModal.querySelector('select[name="pmtStatus"]').options)if(t.textContent===this.children[6].textContent){t.selected=!0;break}e.UpdateModal.querySelector('textarea[name="comments"]').value=this.children[7].textContent;const t=new FormData;t.append("oId",JSON.stringify(+this.getAttribute("data-entity-id"))),t.append("REQUEST_ACTION","READ_ORDERPRODUCT"),fetch(e.CrudUrl,{method:"POST",body:t}).then((e=>e.json())).then((t=>{if(t.success){const n=e.UpdateModal.querySelector("content-rui");n.innerHTML=null;for(const a of t.orderProducts){const t=e.CreateProductRow();n.appendChild(t);const s=t.querySelector("select"),i=t.querySelector('input[name="quantity[]"]');for(const e of s.options)if(e.value===a.pId){e.setAttribute("selected","");break}if(s.dispatchEvent(new Event("change")),i.setAttribute("value",a.quantity),i.dispatchEvent(new InputEvent("input")),n.children.length>1)for(let e=0;e<n.children.length;e++)n.children[e].children[0].classList.remove("hidden")}e.UpdateModal.openModal()}})).catch((e=>{}))})),this.RowsContainer.appendChild(n)}}CreateFooter(){this.Footer=document.createElement("footer-rui");const e=document.createElement("num-selected-rows-rui");e.textContent="0 rows selected",this.Footer.appendChild(e),this.CreatePagination(),this.DataGrid.appendChild(this.Footer)}CreatePagination(){this.Pagination=document.createElement("pagination-rui");const e=document.createElement("p");e.className="rows-per-page",e.textContent="Rows per page:";const t=document.createElement("displayed-rows-rui");t.innerHTML=`<offset-min-rui>${this.NumRows>0?1:0}</offset-min-rui>-<offset-max-rui>${this.NumRows>=this.RPPDV?this.RPPDV:this.NumRows}</offset-max-rui> of <num-rows-rui>${this.NumRows}</num-rows-rui>`;this.Pagination.appendChild(e),this.Pagination.appendChild((()=>{const e=[];for(const t of this.RPPVs)t===this.RPPDV?e.push({value:t,textContent:t,selected:""}):e.push({value:t,textContent:t});const t=this;return Select({attrs:{"data-rows-per-page-value":""},evts:{change:function(){const e=t.DataGrid.querySelector("offset-min-rui"),n=t.DataGrid.querySelector("offset-max-rui"),a=t.DataGrid.querySelector('button[title="Go to next page"]'),s=+e.textContent+ +this.value-1;s<=t.NumRows?n.textContent=s:n.textContent=t.NumRows,+n.textContent===t.NumRows?a.disabled=!0:a.disabled=!1,t.ReadData()}},options:e})})()),this.Pagination.appendChild(t),this.Pagination.appendChild((()=>{const e=document.createElement("pagination-actions-rui");return this.PrevPageBtn=document.createElement("button"),this.PrevPageBtn.type="button",this.PrevPageBtn.title="Go to previous page",this.PrevPageBtn.disabled=!0,this.PrevPageBtn.innerHTML='<i class="fas fa-chevron-left"></i>',this.NextPageBtn=document.createElement("button"),this.NextPageBtn.type="button",this.NextPageBtn.title="Go to next page",this.NextPageBtn.disabled=this.NumRows<=this.RPPDV,this.NextPageBtn.innerHTML='<i class="fas fa-chevron-right"></i>',e.appendChild(this.PrevPageBtn),e.appendChild(this.NextPageBtn),e})()),this.Footer.appendChild(this.Pagination)}SizeColumns(){const e=this.HeadingsContainer.querySelectorAll("hcol-rui"),t=this.RowsContainer.querySelectorAll("row-rui");for(const n of t)for(let t=1;t<n.children.length;t++)n.children[t].style.minWidth=e[t].style.minWidth,n.children[t].style.maxWidth=e[t].style.maxWidth}HideColumns(){const e=this.HeadingsContainer.querySelectorAll("hcol-rui.hide");for(const t of e){const e=+t.children[1].getAttribute("data-colindex"),n=this.RowsContainer.querySelectorAll(`[data-colindex="${e}"]`);for(const e of n)e.classList.add("hide")}}SetupAllCheckbox(){const e=this.DataGrid.querySelector("[data-checkbox-group-all]"),t=this;e.addEventListener("change",(function(){const e=t.RowsContainer.querySelectorAll("[data-checkbox-group-single]");if(this.checked)for(const t of e)t.checked||t.click();else for(const t of e)t.checked&&t.click()}))}SetupCheckboxes(){const e=this.DataGrid.querySelector("[data-checkbox-group-all]"),t=e.nextElementSibling,n=this.DataGrid.querySelectorAll("[data-checkbox-group-single]"),a=this.DataGrid.querySelector("num-selected-rows-rui"),s=this;for(let i=0;i<n.length;i++)n[i].addEventListener("change",(function(){let o=+e.getAttribute("data-checkbox-selected-count");this.checked?(s.RowsContainer.children[i].classList.add("selected"),o++,e.setAttribute("data-checkbox-selected-count",o)):(s.RowsContainer.children[i].classList.remove("selected"),o--,e.setAttribute("data-checkbox-selected-count",o)),0===o?(e.checked=!1,t.className="far fa-square icon"):o===n.length?(e.checked=!0,t.className="fas fa-check-square icon checked"):(e.checked=!0,t.className="fas fa-minus-square icon checked"),a.textContent=1===o?`${o} row selected`:`${o} rows selected`}))}ResizeColumn(e,t){const n=this.PxToRem(t),a=this.HeadingsContainer.children[0].children[+e.getAttribute("data-colindex")+1],s=this.RowsContainer.querySelectorAll(`[data-colindex="${e.getAttribute("data-colindex")}"]`);a.style.minWidth=`${n}rem`,a.style.maxWidth=`${n}rem`;for(const e of s)e.style.minWidth=`${n}rem`,e.style.maxWidth=`${n}rem`}SetupResizingColumns(){const e=this,t=this.DataGrid.querySelector("headings-rui"),n=t.querySelectorAll("resizable-rui"),a={x:0,colIndex:0,minWidth:5,minLeft:0},s=e=>{const n=t.querySelectorAll("hcol-rui")[a.colIndex+1],s=n.getBoundingClientRect().width;if(this.PxToRem(s)===a.minWidth&&(a.minLeft=a.minLeft<0?e.clientX:a.minLeft),e.clientX<a.minLeft)return;const i=e.clientX-a.x;a.x=e.clientX;const o=this.PxToRem(s+i);if(o<a.minWidth)return;n.style.minWidth=`${o}rem`,n.style.maxWidth=`${o}rem`;const l=this.RowsContainer.querySelectorAll(`[data-colindex="${a.colIndex}"]`);for(let e of l)e.style.minWidth=`${o}rem`,e.style.maxWidth=`${o}rem`},i=()=>{t.querySelector("resizable-rui.active").classList.remove("active"),window.removeEventListener("mousemove",s),window.removeEventListener("mouseup",i)};for(let t=0;t<n.length;t++)n[t].addEventListener("mousedown",(function(e){a.x=e.clientX,a.colIndex=+this.getAttribute("data-colindex"),a.minLeft=-1,this.classList.add("active"),window.addEventListener("mousemove",s),window.addEventListener("mouseup",i)})),n[t].addEventListener("dblclick",(function(t){let n=this.previousElementSibling.scrollWidth;const a=e.RowsContainer.querySelectorAll(`[data-colindex="${this.getAttribute("data-colindex")}"]`);for(const e of a)e.scrollWidth+1>n&&(n=e.scrollWidth+1);n>this.previousElementSibling.offsetWidth&&e.ResizeColumn(a[0],n+10)}))}SetupNextPrevBtns(){const e=this.Pagination.querySelector("[data-rows-per-page-value]"),t=this.Pagination.querySelector("offset-min-rui"),n=this.Pagination.querySelector("offset-max-rui"),a=this;this.NextPageBtn.addEventListener("click",(function(){const s=+t.textContent+ +e.value,i=+n.textContent+ +e.value;s>a.NumRows?+e.value<=a.NumRows&&(t.textContent=s):t.textContent=s,i>a.NumRows?(n.textContent=a.NumRows,this.disabled=!0):n.textContent=i,a.PrevPageBtn.disabled=!1,a.ReadData()})),this.PrevPageBtn.addEventListener("click",(function(){const s=+t.textContent-+e.value;let i=+n.textContent-+e.value,o=!1;this.disabled=s<=1,s<1?a.NumRows>0?t.textContent=1:t.textContent=0:t.textContent=s,+n.textContent===a.NumRows?(i=+t.textContent+ +e.value-1,i>a.NumRows?(n.textContent=a.NumRows,o=!0):n.textContent=i):n.textContent=i,+n.textContent-+t.textContent+1<+e.value&&+e.value<=a.NumRows&&(n.textContent=+t.textContent+ +e.value-1),a.NextPageBtn.disabled=o,a.ReadData()}))}ResetRowsSelected(){const e=this.DataGrid.querySelector("[data-checkbox-group-all]");+e.getAttribute("data-checkbox-selected-count")>0&&e.click()}ElemIsDescendantOf(e,t){if(e===t)return 0;for(let n=e.parentElement;null!==n;n=n.parentElement)if(n===t)return 1;return-1}GetFilters(){const e=this.Toolbar.querySelectorAll("toolbar-panel-rui.filters row-rui[data-has-filter]"),t=[];for(let n=0;n<e.length;n++){const a={operator:!1,column:e[n].children[2].children[0].value,operation:e[n].children[3].children[0].value,filterValue:e[n].children[4].children[0].value};n>0&&(a.operator=e[n].children[1].children[0].value),t.push(a)}return JSON.stringify(t)}GetSorts(){const e=this.Toolbar.querySelectorAll("toolbar-panel-rui.sorts row-rui[data-has-sort]"),t=[];for(const n of e)t.push({order:n.children[0].children[0].value,column:n.children[1].getAttribute("data-column"),direction:n.children[2].children[0].value});return t.sort(((e,t)=>+e.order-+t.order)),JSON.stringify(t)}ReadData(){const e=new FormData;e.append("REQUEST_ACTION","READ"),e.append("sorts",this.GetSorts()),e.append("filters",this.GetFilters()),e.append("limit",this.Pagination.querySelector("[data-rows-per-page-value]").value),e.append("offset",this.Pagination.querySelector("offset-min-rui").textContent-1),fetch(this.CrudUrl,{method:"POST",body:e}).then((e=>e.json())).then((e=>{this.Rows=e.rows,this.RowIDs=e.rowIds,this.NumRows!==e.numRows&&(this.NumRows=e.numRows,this.Pagination.querySelector("num-rows-rui").textContent=this.NumRows),0===e.numRows&&(this.Pagination.querySelector("offset-min-rui").textContent=0,this.Pagination.querySelector("offset-max-rui").textContent=0),e.numRows<=+this.Pagination.querySelector("[data-rows-per-page-value]").value&&(this.NextPageBtn.disabled=!0,this.Pagination.querySelector("offset-max-rui").textContent=e.numRows),this.ResetRowsSelected(),this.CreateRows(),this.SizeColumns(),this.HideColumns(),this.SetupCheckboxes()})).catch((e=>{}))}FilterReadData(){this.Pagination.querySelector("offset-min-rui").textContent=1,this.Pagination.querySelector("offset-max-rui").textContent=this.Pagination.querySelector("[data-rows-per-page-value]").value,this.PrevPageBtn.disabled=!0,this.NextPageBtn.disabled=!1,this.ReadData()}}